<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | ShopElectro</title>
<style>
  :root{--bg:#121212;--card:#1e1e1e;--muted:#2a2a2a;--accent:#ff6600}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui;background:var(--bg);color:#fff;padding:24px}
  header{display:flex;align-items:center;gap:20px;margin-bottom:18px}
  header a{color:var(--accent);text-decoration:none;font-weight:700}
  .wrap{display:grid;grid-template-columns:1fr 360px;gap:20px}
  .card{background:var(--card);padding:18px;border-radius:12px}
  label{display:block;margin:12px 0 6px;color:#cfcfcf;font-weight:600}
  input[type="text"], input[type="number"], select, textarea {
    width:100%;padding:10px;border-radius:8px;border:none;background:var(--muted);color:#fff;
  }
  .row{display:flex;gap:12px}
  .btn{background:var(--accent);color:#111;border:none;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700}
  .muted{background:#333;color:#ddd;padding:8px 12px;border-radius:8px}
  .list{margin-top:16px;max-height:420px;overflow:auto}
  .product-row{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:#171717;margin-bottom:8px;align-items:center}
  .product-row small{color:#aaa}
  .danger{background:#7a2f2f}
</style>
</head>
<body>

<header>
  <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
  <div style="font-weight:700">–ê–¥–º–∏–Ω: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div>
</header>

<div class="wrap">

  <div class="card">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>

    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input id="inpName" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≥—Ä–æ–≤–∞—è –º—ã—à—å GX100">

    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
    <select id="inpCategory">
      <option value="mouse">–ú—ã—à–∏</option>
      <option value="keyboard">–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã</option>
      <option value="monitor">–ú–æ–Ω–∏—Ç–æ—Ä—ã</option>
      <option value="other">–î—Ä—É–≥–æ–µ</option>
    </select>

    <label>–ë—Ä–µ–Ω–¥</label>
    <input id="inpBrand" type="text" placeholder="Brand A">

    <label>–¶–µ–Ω–∞ (‚Ç∏)</label>
    <input id="inpPrice" type="number" min="0" value="1000">

    <label>–†–µ–π—Ç–∏–Ω–≥ (1-5)</label>
    <input id="inpRating" type="number" min="0" max="5" value="4">

    <label>–í –Ω–∞–ª–∏—á–∏–∏</label>
    <select id="inpStock">
      <option value="true">–í –Ω–∞–ª–∏—á–∏–∏</option>
      <option value="false">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
    </select>

    <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL)</label>
    <input id="inpImg" type="text" placeholder="https://... (–∏–ª–∏ –ø—É—Å—Ç–æ–µ)">

    <label>–ê—Ä—Ç–∏–∫—É–ª (ID) ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ</label>
    <input id="inpId" type="number" placeholder="123">

    <label>–î–æ–ø. –¥–∞–Ω–Ω—ã–µ (JSON) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä: {"color":"—á—ë—Ä–Ω—ã–π"}</label>
    <textarea id="inpMeta" rows="3" placeholder='{"color":"—á—ë—Ä–Ω—ã–π"}'></textarea>

    <div style="margin-top:14px" class="row">
      <button id="btnAdd" class="btn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
      <button id="btnClear" class="muted">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è</button>
    </div>

    <div id="msg" style="margin-top:12px;color:#9f9"></div>
  </div>

  <aside class="card">
    <h3>–¢–µ–∫—É—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ (–ª–æ–∫–∞–ª—å–Ω–æ)</h3>
    <div style="margin-bottom:8px;color:#bbb">–§–∞–π–ª –∫–∞—Ç–∞–ª–æ–≥–∞: <code>/mnt/data/catalog.html</code></div>
    <div style="margin-bottom:12px;color:#bbb">–ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –∫–ª—é—á: <code>catalogProducts</code></div>

    <div class="list" id="list"></div>

    <div style="margin-top:12px" class="row">
      <button id="btnExport" class="muted">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <button id="btnReset" class="danger muted" style="background:#3a2020;color:#fff">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥</button>
    </div>
  </aside>

</div>

<script>
(function(){
  const KEY = 'catalogProducts';
  const listEl = document.getElementById('list');
  const msg = document.getElementById('msg');

  function readLocal() {
    try {
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : null;
    } catch(e) { return null; }
  }

  function writeLocal(arr) {
    localStorage.setItem(KEY, JSON.stringify(arr));

    window.dispatchEvent(new Event('storage'));
    msg.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ';
    setTimeout(()=>msg.textContent='',1500);
    renderList();
  }

  function generateId() {
    const cur = readLocal() || [];
    const max = cur.reduce((m,i)=>Math.max(m,i.id||0),0);
    return max + 1;
  }

  function getDefault() {

    return [
      { id: 1, name: '–ò–≥—Ä–æ–≤–∞—è –º—ã—à—å GX100', category: 'mouse', brand: 'Brand A', price: 1490, rating: 4, stock: true, img: 'images/gx100_1.jpg', meta: { color: '—á—ë—Ä–Ω—ã–π' } },
      { id: 2, name: '–û—Ñ–∏—Å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ KB200', category: 'keyboard', brand: 'Brand B', price: 2290, rating: 3, stock: true, img: 'images/gx100.jpg', meta: {} }
    ];
  }

  function renderList() {
    const arr = readLocal() || getDefault();
    listEl.innerHTML = arr.map(p=>{
      return `<div class="product-row">
        <div>
          <div style="font-weight:700">${escapeHtml(p.name)}</div>
          <small>${p.category} ‚Ä¢ ${p.brand} ‚Ä¢ ‚Ç∏ ${p.price}</small>
        </div>
        <div>
          <button data-id="${p.id}" class="edit muted">–†–µ–¥</button>
        </div>
      </div>`;
    }).join('');
    listEl.querySelectorAll('.edit').forEach(b=>{
      b.addEventListener('click',()=> {
        const id = Number(b.dataset.id);
        fillForm(id);
      });
    });
  }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  function fillForm(id) {
    const arr = readLocal() || getDefault();
    const p = arr.find(x=>x.id===id);
    if(!p) return;
    document.getElementById('inpId').value = p.id;
    document.getElementById('inpName').value = p.name;
    document.getElementById('inpCategory').value = p.category || 'other';
    document.getElementById('inpBrand').value = p.brand || '';
    document.getElementById('inpPrice').value = p.price || 0;
    document.getElementById('inpRating').value = p.rating || 0;
    document.getElementById('inpStock').value = p.stock ? 'true' : 'false';
    document.getElementById('inpImg').value = p.img || '';
    document.getElementById('inpMeta').value = JSON.stringify(p.meta || {}, null, 0);
    window.scrollTo({top:0,behavior:'smooth'});
  }

  document.getElementById('btnAdd').addEventListener('click', ()=>{
    const idVal = document.getElementById('inpId').value.trim();
    const id = idVal ? Number(idVal) : null;
    const name = document.getElementById('inpName').value.trim();
    const category = document.getElementById('inpCategory').value;
    const brand = document.getElementById('inpBrand').value.trim();
    const price = Number(document.getElementById('inpPrice').value) || 0;
    const rating = Number(document.getElementById('inpRating').value) || 0;
    const stock = document.getElementById('inpStock').value === 'true';
    const img = document.getElementById('inpImg').value.trim() || '';
    let meta = {};
    try {
      const t = document.getElementById('inpMeta').value.trim();
      meta = t ? JSON.parse(t) : {};
    } catch (e) {
      alert('–ü–æ–ª–µ –¥–æ–ø. –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON');
      return;
    }
    if(!name) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'); return; }

    let arr = readLocal() || getDefault();
    if(id) {

      const idx = arr.findIndex(x=>x.id===id);
      if(idx > -1) {
        arr[idx] = { id, name, category, brand, price, rating, stock, img, meta };
      } else {
        arr.push({ id, name, category, brand, price, rating, stock, img, meta });
      }
    } else {
      const newId = generateId();
      arr.push({ id: newId, name, category, brand, price, rating, stock, img, meta });
    }
    writeLocal(arr);
    clearForm();
  });

  document.getElementById('btnClear').addEventListener('click', clearForm);
  function clearForm(){
    document.getElementById('inpId').value = '';
    document.getElementById('inpName').value = '';
    document.getElementById('inpBrand').value = '';
    document.getElementById('inpPrice').value = 1000;
    document.getElementById('inpRating').value = 4;
    document.getElementById('inpImg').value = '';
    document.getElementById('inpMeta').value = '';
    document.getElementById('inpStock').value = 'true';
    msg.textContent = '';
  }

  document.getElementById('btnExport').addEventListener('click', ()=>{
    const arr = readLocal() || getDefault();
    const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'catalog-export.json';
    a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById('btnReset').addEventListener('click', ()=>{
    if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
    localStorage.removeItem(KEY);
    renderList();
    window.dispatchEvent(new Event('storage'));
  });


  renderList();
})();
</script>
</body>
</html>
